要实现应用程序之间的交互，我们需要一个能够在浏览器和Web服务器之间传递请求和响应的机制。  
由于请求和相应都是由0和1组成的数字信息，所以可以说，我们需要的是一种能够将数字信息搬运到指定目的地的机制。  
这种机制是由操作系统中的网络控制软件，以及交换机、路由器等设备分工合作来实现的，它的基本思路是将数字信息分割成一个一个的小块，然后装入一些被称为“包”（Packet）的容器中来运送。  
这个负责搬运数字信息的机制，再加上浏览器和Web服务器这些网络应用程序，这两部分就组成了网络。  

# 章节主要内容

## 第1章 Web浏览器

首先介绍浏览器的工作方式，当输入网址时，浏览器就会按照一定的规则去分析这个网址的含义，然后根据其含义生成请求消息。  
接着浏览器就会委托操作系统中的网络控制软件将消息发送给服务器。  

## 第2章 协议栈、网卡

介绍探索搬运数据的机制。  
首先介绍协议栈（网络控制软件叫作协议栈）。这个软件会将从浏览器接收到的消息打包，然后加上目的地址等控制信息。  
接下来，协议栈会将包交给网卡（负责以太网或无线网络通信的硬件）。  
然后，网卡会将包转换为电信号并通过网线发送出去。这样一来，包就进入到网络之中了。  

## 第3章 集线器、交换机、路由器

本章假设客户端计算机是连接到家庭或公司的局域网中，然后再通过ADSL和光纤到户（FTTH）等宽带线路接入互联网。  
在这样的场景中，网卡发送的包会经过交换机等设备，到达用来接入互联网的路由器。路由器的后面就是互联网，网络运营商会负责将包送到目的地。  

## 第4章 接入网、网络运营商

数据从用来接入互联网的路由器出发，进入了互联网的内部。互联网的入口线路称为接入网。  
在骨干网中存在很多运营商和大量的路由器，这些路由器相互连接，组成一张巨大的网，而我们的网络包就在其中经过若干路由器的接力，最终被发送到目标Web服务器上。  

## 第5章 防火墙、缓存服务器

通过骨干网之后，网络包最终到达了Web服务器所在的局域网中。  
接着，它会遇到防火墙，防火墙会对进入的包进行检查。  
检查完之后，网络包接下来可能还会遇到缓存服务器。  
此外，在大型网站中，可能还会配备将消息分布到多台Web服务器上的负载均衡器，还有可能会使用通过分布在整个互联网中的缓存服务器来分发内容的服务。  
经过这些机制之后，网络包才会到达Web服务器。  

## 第6章 Web服务器

当网络包到达Web服务器后，数据会被解包并还原为原始的请求消息，然后交给Web服务器程序。  
接下来，Web服务器程序分析请求消息的含义，并按照其中的指示将数据装入响应消息中，然后发回给客户端。  
  - 响应消息回到客户端的过程和之前我们介绍的过程正好相反。
当响应到达客户端之后，浏览器会从中读取出网页的数据并在屏幕上显示出来。  

# 涉及到的主要关键词

## 第1章 浏览器生成消息

浏览器、Web服务器、网址（URL）、HTTP、HTML、协议、URI、请求消息、解析器、Socket库、DNS服务器、域名  

## 第2章 用电信号传输TCP/IP数据

TCP/IP、套接字、协议栈、IP地址、端口号、包、头部、网卡、网卡驱动、MAC地址、以太网控制器、ICMP、UDP  

## 第3章 从网线到网络设备

局域网（LAN）、双绞线、串扰、中继式集线器、MDI、MDI-X、交换式集线器、全双工、半双工、碰撞、自动协商、路由器、  
路由表、子网掩码、默认网关、分片、地址转换、公有地址、私有地址  

## 第4章 通过接入网进入互联网内部

ADSL、FTTH、光纤、接入网、ADSL􀀀Modem集成式路由器、ATM、信元、正交振幅调制、分离器、DSLAM、宽带接入服务器、  
远程接入服务器、PPP、网络运行中心（NOC）、光纤、IX（Internet􀀀eXchange，互联网交换）  

## 第5章 服务器端的局域网中有什么玄机

防火墙、包过滤、数据中心、轮询、负载均衡器、缓存服务器、代理、代理服务器、内容分发服务、重定向  

## 第6章 请求到达Web服务器，响应返回浏览器

响应消息、多任务、多线程、虚拟目录、CGI、表单、访问控制、密码、数据格式、MIME  

# 第1章 浏览器生成消息——探索浏览器内部

## 热身问答

1. http://www.nikkeibp.co.jp/中的www只是Web服务器上的一种命名。  
   World Wide Web是Web的提出者最早开发的浏览器兼HTML编辑器的名字。  

2. 如果是“.com”“.net”“.org”“.jp”（除“co.jp”“ne.jp”等“xx.jp”格式的域名外）等没有对注册对象范围进行限制的域名，任何个人都可以申请注册。  
   - 在中国的情况，个人可以申请“.cn”域名，但“.com.cn”“.net.cn”等域名则是不开放给个人注册的。
   - 日本的域名体系中，“.jp”下级的域名用的是两个字母的命名，例如“.co.jp”“.ne.jp”。
   此外，也有一种“.name”域名是专门为个人申请者准备的。  
   
3. 应用程序并不是自己去控制网络，而是委托操作系统来控制网络。  

## 看点

### 生成HTTP请求消息

用户在浏览器输入网址（URL） -\> 浏览器解析网址 -\> 浏览器根据网址含义生成请求信息

### 向DNS服务器查询Web服务器的IP地址

请求消息生成之后，浏览器会委托操作系统向Web服务器发送请求，但浏览器必须告诉操作系统接收方的IP地址才行，因此浏览器必须先查出Web服务器的IP地址。  
网址中只有Web服务器的域名，因此浏览器需要向DNS服务器查询域名对应的IP地址。  

### 全世界DNS服务器的大接力

全世界共有上万台DNS服务器，它们相互接力才能完成IP地址的查询，而它们进行接力的方法也是本章看点之一。  

### 委托协议栈发送消息

查询到IP地址之后，浏览器就可以将消息委托给操作系统发送给Web服务器了，但这个委托到底是如何完成的呢？这也是本章看点之一。  
理解了向操作系统进行委托时的规则，我们就能够明白做出某个委托时操作系统会给我们怎样的反馈，这可以说是相当于具体地理解了网络的潜在能力。  

## 生成HTTP请求消息

### 输入网址

#### 网址的定义

网址，准确来说应该叫URL，是以http://开头的那一串东西；  
实际上除了“http:”，网址还可以以其他一些文字开头，例如“ftp:”“ file:”“mailto:”等。  

浏览器是一个具备多种客户端功能的综合性客户端软件，因此它需要一些东西来判断应该使用其中哪种功能来访问相应的数据，  
而各种不同的URL就是用来干这个的，比如访问Web服务器时用“http:”，而访问FTP服务器下载和上传文件时用“ftp:”。  

#### 网址的格式

根据访问目标的不同，URL的写法也会不同。  
  - 在访问Web服务器和FTP服务器时，URL中会包含服务器的域名和要访问的文件的路径名等；
  - 发邮件的URL则包含收件人的邮件地址。
此外，根据需要，URL中还会包含用户名、密码、服务器端口号等信息。  

##### URL的各种格式

用HTTP协议访问Web服务器时：  
|http://|user|:|password|@|www.glasscom.com|:80|/dir/file1.htm|
|---|---|---|---|---|---|---|---|---|
||用户名（可省略）||密码（可省略）||Web服务器域名|端口号（可省略）|文件的路径名|

用FTP协议下载和上传文件时：  
|ftp://|user|:|password|@|ftp.glasscom.com|:21|/dir/file1.htm|
|---|---|---|---|---|---|---|---|---|
|协议|用户名（可省略）||密码（可省略）||FTP服务器域名|端口号（可省略）|文件的路径名|

读取客户端计算机本地文件时:  
|file://|localhost|/c:/path/file1.zip|
|---|---|---|
||计算机名（可省略）|文件的路径名|

发送电子邮件时：  
|mailto:|tone@glasscom.com|
|---|---|
||邮件地址|

阅读新闻组的文章时:  
|news:|comp.protocols.tcp-ip|
|---|---|
||新闻组名|

尽管URL有各种不同的写法，但它们有一个共同点，那就是URL开头的文字，即“http:”“ftp:”“file:”“mailto:”这部分文字都表示浏览器应当使用的访问方法。  
  - 访问Web服务器时应该使用HTTP协议；
  - 访问FTP服务器时则应该使用FTP协议。
因此，我们可以把这部分理解为访问时使用的协议类型。  
尽管后面部分的写法各不相同，但开头部分的内容决定了后面部分的写法，因此并不会造成混乱。  

> 1. HTTP：Hypertext Transfer Protocol，超文本传送协议。
  2. 协议：通信操作的规则定义称为协议（protocol）。

### 解析网址

浏览器要做的第一步工作就是对URL进行解析，从而生成发送给Web服务器的请求消息。  
具体步骤：  
1. 按照 URL规格对字符串进行解析；
2. 将 URL拆分为各个组成元素；
3. 分别理解各个元素的语义含义；
   - 主机名用于确定要访问的服务器；
   - 路径名用于确定服务器上要访问的具体资源位置。
4. 根据解析结果确定访问目标。

### 































































































































































































































































































































































































































































































































































































































































